<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Навигатор РЖДК — Уссурийск</title>
<script src="https://api-maps.yandex.ru/2.1/?apikey=be0c8369-7476-47a3-a315-59ab429fadcb&lang=ru_RU"></script>

<style>
:root {
    --bg:#07070a;
    --accent:#00ffd0;
    --accent2:#6f56ff;
    --muted:#8aa0b1;
}
*{box-sizing:border-box}

body{
    margin:0;
    height:100vh;
    font-family:Inter,Segoe UI,Arial;
    background:linear-gradient(180deg,#03040a,#071021);
    color:#e6f7f1;
    overflow:hidden;
}

/* TOPBAR */
.topbar{
    position:fixed;
    left:0; right:0; top:0;
    height:64px;
    display:flex;
    align-items:center;
    gap:16px;
    padding:10px 18px;
    z-index:2000;
    background:rgba(0,0,0,0.2);
    backdrop-filter:blur(6px);
}
.logo{
    width:44px;height:44px;
    border-radius:10px;
    background:linear-gradient(135deg,var(--accent2),var(--accent));
    font-weight:700;
    display:flex;
    align-items:center;
    justify-content:center;
}

/* MAP */
.map-wrap{
    position:fixed;
    inset:64px 0 0 0;
}
#map{width:100%;height:100%}

/* BUILDINGS BUTTONS */
.buildings-bar{
    position:fixed;
    left:50%;
    transform:translateX(-50%);
    bottom:18px;
    display:flex;
    gap:6px;
    padding:6px 10px;
    border-radius:999px;
    z-index:2500;
    max-width:95%;
    overflow-x:auto;
}
.buildings-bar::-webkit-scrollbar{display:none}
.building-btn{
    background:linear-gradient(90deg,var(--accent2),var(--accent));
    padding:7px 12px;
    border-radius:999px;
    border:none;
    color:#051018;
    font-weight:700;
    font-size:13px;
    cursor:pointer;
    white-space:nowrap;
}

/* INFO SHEET */
.building-sheet{
    position:fixed;
    left:12px; right:12px; bottom:12px;
    background:rgba(255,255,255,0.95);
    backdrop-filter:blur(8px);
    border-radius:14px;
    padding:18px;
    z-index:2600;
    max-width:980px;
    margin:auto;
    transform:translateY(140%);
    transition:transform .45s cubic-bezier(.2,.9,.2,1);
    box-shadow:0 10px 40px rgba(0,0,0,.6);
    color:#051018;
}
.building-sheet.show{
    transform:translateY(0);
}

/* CLOSE BUTTON */
.close-x{
    position:absolute;
    right:18px; top:12px;
    font-size:26px;
    font-weight:900;
    cursor:pointer;
    line-height:1;
    user-select:none;
}

/* PLAN */
.plan{
    height:220px;
    border-radius:8px;
    background:rgba(0,0,0,0.05);
    display:flex;
    align-items:center;
    justify-content:center;
    border:1px dashed rgba(0,0,0,0.1);
    overflow:hidden;
    margin-top:12px;
}
.plan img{
    width:100%;
    height:100%;
    object-fit:contain;
}

.floor-btn{
    background:#0c1525;
    border:1px solid rgba(255,255,255,0.1);
    border-radius:8px;
    padding:6px 10px;
    color:white;
    cursor:pointer;
}
.btn-accent{
    background:linear-gradient(90deg,var(--accent2),var(--accent)) !important;
    color:#051018 !important;
}

@media(max-width:900px){
    .building-sheet{left:8px; right:8px}
}
</style>
</head>

<body>

<div class="topbar">
    <div class="logo">RZ</div>
</div>

<div class="map-wrap"><div id="map"></div></div>
<div class="buildings-bar" id="buildingsBar"></div>

<!-- INFO PANEL -->
<div class="building-sheet" id="buildingSheet">
    <div class="close-x" onclick="closeSheet()">×</div>

    <h2 id="sheetTitle">Название</h2>
    <div id="sheetAddress" style="margin-bottom:10px;">Адрес</div>

    <div class="plan" id="planBlock">План не найден</div>

    <div id="floorControls" style="display:flex;gap:8px;align-items:center;margin-top:12px">
        <b>Этаж:</b>
        <div id="floorButtons"></div>
    </div>

    <h3 style="margin-top:16px;">Контакты и примечания</h3>
    <div id="sheetNote" style="margin-top:6px; font-size:14px;"></div>
</div>

<script>
/* FULL CONTACTS RESTORED */
const buildingsData = [
    {
        id:1,
        name:"Главный учебный корпус",
        address:"Уссурийск, ул. Чичерина 146",
        coords:[43.792946,131.980634],
        floors:3,
        defaultFloor:1,
        imagePrefix:3,
        detailsHtml:`<b>Тел./факс:</b><br>
            +7 (4234) 354738 — приёмная директора<br>
            +7 (4234) 354663 — бухгалтерия<br>
            +7 (4234) 354810 — учебная часть<br>
            +7 (4234) 354810 — приёмная комиссия<br><br>
            <b>Email:</b> upu16@yandex.ru`
    },

    {
        id:2,
        name:"Учебный корпус (Горького 15)",
        address:"Уссурийск, ул. Горького 15",
        coords:[43.790857,131.944324],
        floors:2,
        defaultFloor:1,
        imagePrefix:1,
        detailsHtml:`<b>Тел.:</b> 8 (4234) 32-07-31`
    },

    {
        id:3,
        name:"Учебно-производственные мастерские",
        address:"Уссурийск, ул. Тургенева 15",
        coords:[43.804885,131.977373],
        floors:2,
        defaultFloor:1,
        imagePrefix:2,
        detailsHtml:`<b>Тел.:</b> 8 (4234) 38-10-86`
    },

    {
        id:4,
        name:"Общежитие",
        address:"Уссурийск, ул. Суханова 66",
        coords:[43.793303,131.955428],
        floors:1,     /* IMPORTANT – auto-hide floors */
        defaultFloor:1,
        imagePrefix:4,
        detailsHtml:`<b>Тел.:</b> 8 (4234) 32-15-45`
    }
];

let map=null;

/* MAP INIT */
function initMap(){
    map=new ymaps.Map('map',{center:buildingsData[0].coords,zoom:17});
    renderButtons();
    renderMarkers();
}

function renderButtons(){
    const bar=document.getElementById("buildingsBar");
    bar.innerHTML="";
    buildingsData.forEach(b=>{
        const btn=document.createElement("button");
        btn.className="building-btn";
        btn.textContent=b.name.replace(/\s\(.*\)/,"");
        btn.onclick=()=>openSheet(b.id);
        bar.appendChild(btn);
    });
}

function renderMarkers(){
    buildingsData.forEach(b=>{
        const pm=new ymaps.Placemark(b.coords,{balloonContent:b.name});
        pm.events.add("click",()=>openSheet(b.id));
        map.geoObjects.add(pm);
    });
}

/* PANEL OPEN */
function openSheet(id){
    const b=buildingsData.find(x=>x.id===id);
    if(!b)return;

    document.getElementById("sheetTitle").textContent=b.name;
    document.getElementById("sheetAddress").textContent=b.address;
    document.getElementById("sheetNote").innerHTML=b.detailsHtml;

    const fc=document.getElementById("floorControls");
    const fb=document.getElementById("floorButtons");
    fb.innerHTML="";

    if(b.floors>1){
        fc.style.display="flex";
        for(let i=1;i<=b.floors;i++){
            const f=document.createElement("button");
            f.className="floor-btn";
            f.textContent="Этаж "+i;
            f.onclick=()=>{
                showFloor(b,i);
                document.querySelectorAll(".floor-btn").forEach(x=>x.classList.remove("btn-accent"));
                f.classList.add("btn-accent");
            };
            fb.appendChild(f);
        }
    } else {
        fc.style.display="none";
    }

    showFloor(b,b.defaultFloor);
    document.getElementById("buildingSheet").classList.add("show");
}

function closeSheet(){
    document.getElementById("buildingSheet").classList.remove("show");
}

/* SHOW PLAN */
function showFloor(b,f){
    const block=document.getElementById("planBlock");
    const file=`images/${b.imagePrefix}_${f}.jpg`;

    fetch(file).then(r=>{
        if(r.ok) block.innerHTML=`<img src="${file}">`;
        else block.innerHTML="План не найден";
    });
}

ymaps.ready(initMap);
</script>
</body>
</html>
